name: üîç Test Token Permissions

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Test Repository Access
        env:
          GH_TOKEN: ${{ secrets.PRIVATE_REPO_TOKEN }}
        run: |
          echo "üîç Probando acceso al repositorio privado..."
          
          # Esta es la prueba CRUCIAL
          RESPONSE=$(curl -s -o response.txt -w "%{http_code}" \
            -H "Authorization: token $GH_TOKEN" \
            https://api.github.com/repos/Odisey25/Main.6.3)
          
          echo "üì° C√≥digo de respuesta: $RESPONSE"
          
          if [ "$RESPONSE" = "200" ]; then
            echo "‚úÖ PERFECTO! Token tiene acceso correcto"
            echo "üìÑ Contenido de la respuesta:"
            cat response.txt | head -20
          elif [ "$RESPONSE" = "404" ]; then
            echo "‚ùå 404 - Repositorio no encontrado"
            echo "   Verifica que 'Main.6.3' existe exactamente as√≠"
          elif [ "$RESPONSE" = "403" ]; then
            echo "‚ùå 403 - Prohibido"
            echo "   El token NO tiene permisos 'repo'"
            echo "   Crea un NUEVO token marcando SOLO:"
            echo "   - [x] repo"
            echo "   - [x] workflow"
          else
            echo "‚ö†Ô∏è C√≥digo inesperado: $RESPONSE"
            cat response.txt
          fi